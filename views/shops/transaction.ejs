<%- include('partials/header', { title }) %>
<%- include('partials/sidebar', { active: 'transactions' }) %>

<div class="content">
  <%- include('partials/topbar', { user }) %>

  <!-- FILTER -->
  <form method="GET" class="card-box mb-4">
    <div class="row g-2 align-items-end">
      <div class="col-md-4">
        <label class="form-label">From</label>
        <input
          type="date"
          name="from"
          value="<%= from %>"
          class="form-control tb-input-dark"
        />
      </div>

      <div class="col-md-4">
        <label class="form-label">To</label>
        <input
          type="date"
          name="to"
          value="<%= to %>"
          class="form-control tb-input-dark"
        />
      </div>

      <div class="col-md-4">
        <button class="btn btn-primary mt-4 w-100">
          Apply Filters
        </button>
      </div>
    </div>
  </form>

  <!-- TRANSACTIONS TABLE -->
  <div class="card-box">
    <h6 class="mb-3">Transaction History</h6>

    <div class="table-responsive">
      <table class="tb-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Order ID</th>
            <th class="text-center">Boxes</th>
            <th class="text-end">Total (₹)</th>
            <th class="text-end">Paid (₹)</th>
            <th class="text-end">Balance (₹)</th>
            <th class="text-center">Payment</th>
          </tr>
        </thead>

        <tbody>
          <% if (transactions.length === 0) { %>
            <tr>
              <td colspan="7" class="text-center text-muted py-4">
                No transactions found
              </td>
            </tr>
          <% } %>

          <% transactions.forEach(t => { %>
            <tr>
              <td><%= t.date %></td>
              <td><%= t.orderId %></td>
              <td class="text-center"><%= t.boxes %></td>

              <td class="text-end text-primary">
                ₹<%= t.total %>
              </td>

              <td class="text-end">
                ₹<%= t.paid %>
              </td>

             <td  class="text-end">
  <% if (t.balance > 0) { %>
    <span class="text-danger">₹<%= t.balance %></span>
  <% } else if (t.balance < 0) { %>
    <span class="text-success">+₹<%= Math.abs(t.balance) %></span>
  <% } else { %>
    <span class="text-muted">₹0</span>
  <% } %>
</td>


              <td class="text-center">
                <% if (t.paymentMethod === "ONLINE") { %>
                  <span class="badge badge-online">ONLINE</span>
                <% } else { %>
                  <span class="badge badge-cod">COD</span>
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <!-- PAGINATION -->
    <div class="tb-pagination mt-3">
      <% if (page > 1) { %>
        <a
          class="tb-page-btn"
          href="?page=<%= page - 1 %>&from=<%= from %>&to=<%= to %>"
        >
          Previous
        </a>
      <% } else { %>
        <span></span>
      <% } %>

      <span class="tb-page-info">
        Page <%= page %> of <%= totalPages %>
      </span>

      <% if (page < totalPages) { %>
        <a
          class="tb-page-btn"
          href="?page=<%= page + 1 %>&from=<%= from %>&to=<%= to %>"
        >
          Next
        </a>
      <% } %>
    </div>
  </div>
</div>

<%- include('partials/footer') %>
