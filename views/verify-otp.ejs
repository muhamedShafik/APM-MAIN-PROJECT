<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tomato Box - Verify OTP</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --bg-color: #020617;
      --card-bg: #020617;
      --accent: #0f274d;
      --accent-soft: rgba(14, 41, 84, 0.45);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-color: rgba(148, 163, 184, 0.45);
      --glow-primary: rgba(59, 130, 246, 0.6);
      --lightning-color: rgba(99, 102, 241, 0.8);
      --wave-color: rgba(16, 185, 129, 0.1);
      --tomato-red: #ef4444;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 40px 20px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-color);
      color: var(--text-main);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Wave Animation */
    .wave-bg {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 200px;
      z-index: 1;
      overflow: hidden;
    }

    .wave {
      position: absolute;
      bottom: 0;
      width: 200%;
      height: 200px;
      background: linear-gradient(45deg, var(--wave-color), transparent);
      animation: wave 10s linear infinite;
      transform: rotateZ(4deg);
    }

    .wave:nth-child(2) {
      animation: wave 10s linear infinite 1s;
      opacity: 0.8;
      background: linear-gradient(-45deg, var(--wave-color), transparent);
    }

    @keyframes wave {
      0% { margin-left: 0; }
      100% { margin-left: -100%; }
    }

    /* Lightning Animation */
    .lightning-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .lightning {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--lightning-color);
      box-shadow: 0 0 10px var(--lightning-color);
      animation: lightningStrike 3s infinite;
    }

    @keyframes lightningStrike {
      0%, 90%, 100% { opacity: 0; transform: translateY(0) scale(1); }
      10% { opacity: 1; transform: translateY(-200vh) scale(1.5); }
      11% { opacity: 0; }
    }

    /* Card Animations */
    @keyframes cardFloat {
      0%, 100% { transform: translateY(0) rotateX(0deg); }
      50% { transform: translateY(-8px) rotateX(1deg); }
    }

    @keyframes cardFadeIn {
      from { opacity: 0; transform: translateY(20px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .login-wrapper {
      background: var(--card-bg);
      border-radius: 24px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      box-shadow: 
        0 25px 50px rgba(15, 23, 42, 0.95),
        0 0 0 1px rgba(59, 130, 246, 0.1);
      backdrop-filter: blur(10px);
      animation: cardFadeIn 0.8s ease-out, cardFloat 4s ease-in-out 0.8s infinite;
      text-align: center;
      position: relative;
      z-index: 10;
    }

    /* SAME as LOGIN PAGE - Smaller Height */
    .login-wrapper {
      width: 100%;
      max-width: 380px; /* SAME width */
      padding: 2rem 1.75rem 1.75rem; /* REDUCED padding */
      margin: 2rem auto;
    }

    /* Logo & App Name - Smaller */
    .logo {
      font-size: 3rem; /* REDUCED from 4rem */
      margin-bottom: 0.25rem;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-8px); }
      60% { transform: translateY(-4px); }
    }

    .app-name {
      font-size: 1.25rem; /* REDUCED */
      font-weight: 700;
      color: var(--tomato-red);
      margin-bottom: 1rem; /* REDUCED */
      text-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
    }

    .subtitle {
      margin: 0 0 1.75rem; /* REDUCED */
      font-size: 0.875rem; /* REDUCED */
      color: var(--text-muted);
      line-height: 1.5;
    }

    /* SMALLER OTP Inputs */
    .otp-inputs {
      display: flex;
      justify-content: center;
      gap: 8px; /* REDUCED gap */
      margin: 1.25rem 0 1rem; /* REDUCED margin */
    }

    .otp-inputs input {
      width: 36px; /* SMALLER */
      height: 40px; /* SMALLER */
      text-align: center;
      font-size: 1rem; /* REDUCED */
      font-weight: 600;
      border-radius: 8px; /* SMALLER radius */
      border: 1.5px solid var(--border-color);
      background: rgba(2, 6, 23, 0.9);
      color: var(--text-main);
      outline: none;
      transition: all 0.25s ease;
    }

    .otp-inputs input:focus {
      border-color: var(--accent);
      box-shadow: 
        0 0 0 3px var(--accent-soft),
        0 6px 20px rgba(15, 118, 185, 0.25);
      transform: translateY(-1px); /* LESS lift */
      background: rgba(2, 6, 23, 0.98);
    }

    /* SMALLER Button */
    .btn-primary {
      width: 100%;
      padding: 0.75rem 1rem; /* SMALLER padding */
      border-radius: 50px;
      border: none;
      background: linear-gradient(135deg, #0b1e3d 0%, #1e3a5f 100%);
      color: white;
      font-weight: 600;
      font-size: 0.9375rem; /* REDUCED */
      cursor: pointer;
      letter-spacing: 0.5px;
      box-shadow: 
        0 18px 35px rgba(11, 30, 61, 0.6),
        0 0 0 1px rgba(59, 130, 246, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      margin: 1rem 0 0.75rem; /* REDUCED */
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }

    .btn-primary:hover::before { left: 100%; }
    .btn-primary:hover {
      transform: translateY(-2px); /* LESS lift */
      box-shadow: 
        0 22px 45px rgba(11, 30, 61, 0.8),
        0 0 0 1px rgba(59, 130, 246, 0.5);
    }

    .helper {
      margin-top: 0.875rem;
      font-size: 0.8125rem; /* SMALLER */
      color: var(--text-muted);
      line-height: 1.4;
    }

    .link {
      margin-top: 1rem;
      font-size: 0.8125rem; /* SMALLER */
      color: #3b82f6;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-block;
    }

    .link:hover {
      color: #60a5fa;
      text-shadow: 0 0 8px var(--glow-primary);
    }

    /* Shake animation */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      75% { transform: translateX(4px); }
    }

    .shake { animation: shake 0.5s ease-in-out; }

    /* SAME Responsive as Login Page */
    @media (min-width: 576px) {
      body { padding: 60px 20px; }
      .login-wrapper {
        width: 440px;
        padding: 2.5rem 2.25rem 2.25rem; /* LESS padding */
        margin: 3rem auto;
      }
      .logo { font-size: 3.25rem; }
    }

    @media (min-width: 768px) {
      body { padding: 80px 2rem; }
      .login-wrapper {
        width: 480px;
        padding: 3rem 2.75rem 2.75rem; /* LESS padding */
        box-shadow: 
          0 40px 80px rgba(15, 23, 42, 0.98),
          0 0 0 1px rgba(59, 130, 246, 0.2);
      }
      .logo { font-size: 3.75rem; }
      .otp-inputs { gap: 10px; }
    }

    @media (min-width: 1200px) {
      .login-wrapper {
        width: 520px;
        padding: 3.25rem 3rem 3rem; /* LESS padding */
      }
    }
  </style>
</head>
<body>
  <!-- Lightning Background -->
  <div class="lightning-bg" id="lightningBg"></div>
  
  <!-- Wave Animation -->
  <div class="wave-bg">
    <div class="wave"></div>
    <div class="wave"></div>
  </div>

  <!-- Compact OTP Card - SAME as Login -->
  <div class="login-wrapper">
    <h1 class="logo">üçÖ</h1>
    <div class="app-name">Tomato Box</div>

    <form id="otpForm" class="otp-section" method="post" action="/auth/verify-otp">
      <p class="subtitle mb-3">Enter the OTP sent to your number</p>

      <div class="otp-inputs">
        <input type="text" name="d1" maxlength="1" required autocomplete="one-time-code" />
        <input type="text" name="d2" maxlength="1" required autocomplete="one-time-code" />
        <input type="text" name="d3" maxlength="1" required autocomplete="one-time-code" />
        <input type="text" name="d4" maxlength="1" required autocomplete="one-time-code" />
        <input type="text" name="d5" maxlength="1" required autocomplete="one-time-code" />
        <input type="text" name="d6" maxlength="1" required autocomplete="one-time-code" />
      </div>

      <button type="submit" class="btn-primary mb-3">Verify OTP</button>
      
      <p class="helper mb-2">OTP valid for 2 minutes</p>
      <a href="/auth/resend-otp" class="link">
        <i class="bi bi-arrow-clockwise me-1"></i>Resend OTP
      </a>
    </form>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <script>
    // Lightning effect
    function createLightning() {
      const lightning = document.createElement('div');
      lightning.className = 'lightning';
      lightning.style.left = Math.random() * 100 + '%';
      lightning.style.animationDelay = Math.random() * 2 + 's';
      lightning.style.animationDuration = (Math.random() * 2 + 2) + 's';
      document.getElementById('lightningBg').appendChild(lightning);
      setTimeout(() => lightning.remove(), 5000);
    }

    setInterval(createLightning, 8000);
    createLightning();

    // OTP INPUT LOGIC
    const inputs = document.querySelectorAll(".otp-inputs input");
    const form = document.getElementById("otpForm");

    inputs.forEach((input, index) => {
      input.addEventListener("input", () => {
        if (input.value.length === 1 && index < inputs.length - 1) {
          inputs[index + 1].focus();
        }
        if (input.value.length > 1) {
          input.value = input.value.slice(0, 1);
        }
        input.value = input.value.replace(/\D/g, '');
      });

      input.addEventListener("keydown", (e) => {
        if (e.key === "Backspace" && input.value === "" && index > 0) {
          inputs[index - 1].focus();
        }
        if (e.key === "Enter") {
          form.dispatchEvent(new Event('submit'));
        }
      });

      if (index === 0) {
        input.focus();
      }
    });

    form.addEventListener("submit", (e) => {
      const otpValues = Array.from(inputs).map(input => input.value).join('');
      if (otpValues.length !== 6) {
        e.preventDefault();
        inputs[0].classList.add('shake');
        setTimeout(() => inputs[0].classList.remove('shake'), 500);
      }
    });

    // URL params
    const Toast = Swal.mixin({
      toast: true,
      position: "bottom-end",
      showConfirmButton: false,
      timer: 3000,
      timerProgressBar: true,
      background: "#020617",
      color: "#e5e7eb",
      iconColor: "#ef4444"
    });

    const params = new URLSearchParams(window.location.search);
    if (params.get("error")) {
      Toast.fire({ icon: "error", title: params.get("error") });
      history.replaceState({}, "", location.pathname);
    }
    if (params.get("success")) {
      Toast.fire({ icon: "success", title: params.get("success") });
      history.replaceState({}, "", location.pathname);
    }
  </script>
</body>
</html>
