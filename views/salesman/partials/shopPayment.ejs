<!-- DATE FILTER -->
<div class="card-box mb-3">
  <div class="row g-2 align-items-end">
    <div class="col-md-4">
      <label class="form-label">From</label>
      <input type="date" id="paymentsFrom" class="tb-input-dark">
    </div>
    <div class="col-md-4">
      <label class="form-label">To</label>
      <input type="date" id="paymentsTo" class="tb-input-dark ">
    </div>
    <div class="col-md-4">
      <button class="btn btn-primary" onclick="applyPaymentsFilter()">Apply Filters</button>
    </div>
  </div>
</div>

<!-- PAYMENTS TABLE -->
<div class="card-box">
  <table class="table tb-table align-middle">
    <thead>
      <tr>
        <th>Date</th>
        <th>Boxes</th>
        <th>Price / Box</th>
        <th>Total (₹)</th>
        <th>Paid (₹)</th>
        <th>Balance (₹)</th>
        <th>Method</th>
        <th>Note</th>
      </tr>
    </thead>

   <tbody id="paymentsTable">
  <% transactions.forEach(t => { %>
    <tr class="payment-row" data-date="<%= t.date %>">
      <td><%= t.date %></td>
      <td><%= t.boxes %></td>
      <td>₹<%= t.pricePerBox %></td>
      <td>₹<%= t.total %></td>
      <td class="text-warning">₹<%= t.paid %></td>

      <td class="<%= t.balance > 0 ? 'text-danger' : 'text-success' %>">
        ₹<%= Math.abs(t.balance) %>
      </td>

      <td>
        <span class="badge bg-light text-dark"><%= t.method %></span>
      </td>

      <td><%= t.note || "-" %></td>
    </tr>
  <% }) %>
</tbody>

  </table>

 <div class="tb-pagination mt-3">
  <div class="tb-pagination-info">
    Page <%= page %> of <%= totalPages %>
  </div>

  <div class="tb-pagination-actions">
    <% if (page > 1) { %>
      <a
        href="?tab=payments&page=<%= page - 1 %>"
        class="tb-page-btn"
      >
        Previous
      </a>
    <% } else { %>
      <span class="tb-page-btn tb-page-btn--disabled">Previous</span>
    <% } %>

    <% if (page < totalPages) { %>
      <a
        href="?tab=payments&page=<%= page + 1 %>"
        class="tb-page-btn"
      >
        Next
      </a>
    <% } else { %>
      <span class="tb-page-btn tb-page-btn--disabled">Next</span>
    <% } %>
  </div>
</div>


<script>

function applyPaymentsFilter() {
  const from = document.getElementById("paymentsFrom").value;
  const to = document.getElementById("paymentsTo").value;

  const fromDate = from ? new Date(from) : null;
  const toDate = to ? new Date(to) : null;

  document.querySelectorAll(".payment-row").forEach(row => {
    const d = new Date(row.dataset.date);
    let visible = true;

    if (fromDate && d < fromDate) visible = false;
    if (toDate && d > toDate) visible = false;

    row.style.display = visible ? "" : "none";
  });
}

</script>
